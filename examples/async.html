<html>
<head>
	<title>Calendar drillthrough renderer example</title>
	<!-- highlight JS -->
	<link rel="stylesheet" href="http://yandex.st/highlightjs/7.3/styles/default.min.css">
	<link rel="stylesheet" href="css/calendar.css"></link>
</head>
<body>
	
	<script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>

	<script type="text/javascript" src="js/jquery/jquery-1.8.3.min.js"></script>
	<script type="text/javascript" src="js/d3/d3.min.js"></script>
	<script type="text/javascript" src="js/colorbrewer/colorbrewer.js"></script>

	<!-- PROD -->
	<!-- <script type="text/javascript" src="../calendar.min.js"></script> --> 

	<!-- DEV -->
	<script type="text/javascript" src="../src/event.js"></script>
	<script type="text/javascript" src="../src/calendar.js"></script>
	<script type="text/javascript" src="../src/data.js"></script>
	<script type="text/javascript" src="../src/decorator/legend.js"></script>
	<script type="text/javascript" src="../src/decorator/horodator.js"></script>
	<script type="text/javascript" src="../src/decorator/hovered.js"></script>
	<script type="text/javascript" src="../src/renderer/day.js"></script>
	<script type="text/javascript" src="../src/renderer/week.js"></script>
	<script type="text/javascript" src="../src/renderer/month.js"></script>
	<script type="text/javascript" src="../src/renderer/year.js"></script>
	<script type="text/javascript" src="../src/renderer/drillthrough.js"></script>

	<script id="code">
$.ready = function(){
	
	// Create time series specialization callbacks
	var timeCallback = function(d){ return new Date(d.logDate); };
	var dataCallback = function(d){ return d.taux_co2;  };

	// Create time serie parser
	var parser = Calendar.data.create(timeCallback);
	var data = {};
	var datagrab_closure = function(year){
		var calendar = this;
		if(year instanceof Array){ 
			year = year[year.length - 1];
		}
		console.log(year);
		d3.json("mokup/"+year+"_day.json", function(raw){
			// parse raw data
			var grab = parser(raw);
			data = Calendar.data.merge(data, grab);
			calendar.draw(data);
		});
	}

	var valueCallback = Calendar.data.retreiveValueCallbackClosure(dataCallback, d3.mean);
	// synchronous data loading
	
	/* ************************** */
	/* 
		CALENDAR INITIALIZATION 
	*/
	var calendar = new Calendar( {
		renderer : new Calendar.renderer.year()
		, interactive : false
		, adaptiveHeight : true
		, retreiveDataCallback : datagrab_closure
		, retreiveValueCallback : valueCallback
		, upBound : 100
		, downBound : 20
		, drawLegend: false
		, drawHorodator: false
		, drawHovered: false
	
	});

	calendar.createTiles([2010]);

	setTimeout(function(){
		calendar.createTiles([2010, 2011]);
	},2000);
	setTimeout(function(){
		calendar.createTiles([2010, 2011, 2012]);
	},4000);
	setTimeout(function(){
		calendar.createTiles([2010, 2011, 2012,2013]);
	},6000);


	// code highlight
	$('pre code').text($('script#code').text());
	$('pre code').each(function(i, e) {hljs.highlightBlock(e)});

}
	</script>
	<div id="container">
		<h1>Calendar Async example</h1>
		<div id="decorator_top"></div>
		<div id="vis-container"><div id="vis"></div></div>
		<div id="decorator_bottom"></div>
		<pre><code class="javascript"></code></pre>
	</div>
	<a href="https://github.com/zanni/calendar"><img style="position: absolute; top: 0; right: 0; border: 0;" src="images/github.png" alt="Fork me on GitHub"></a>
</body>
</html>